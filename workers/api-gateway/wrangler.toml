# HR-DSS API Gateway Worker
# Cloudflare Workers 설정

name = "hr-dss-api-gateway"
main = "src/index.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

# 계정 설정 (환경 변수로 오버라이드)
# account_id = ""

[observability]
enabled = true

# 개발 환경 설정
[env.development]
name = "hr-dss-api-gateway-dev"

[env.development.vars]
ENVIRONMENT = "development"
LOG_LEVEL = "debug"
BACKEND_URL = "http://localhost:8000"
ALLOWED_ORIGINS = "http://localhost:3000"

# 스테이징 환경
[env.staging]
name = "hr-dss-api-gateway-staging"
workers_dev = true
# routes는 Zone 권한이 있는 API 토큰 필요
# routes = [
#   { pattern = "api-staging.minu.best/*", zone_name = "minu.best" }
# ]

[env.staging.vars]
ENVIRONMENT = "staging"
LOG_LEVEL = "info"
BACKEND_URL = "https://hr-dss-staging.up.railway.app"
ALLOWED_ORIGINS = "https://staging.hr.minu.best"

# 프로덕션 환경
[env.production]
name = "hr-dss-api-gateway"
workers_dev = true
routes = [
  { pattern = "api-hr.minu.best/*", zone_name = "minu.best" }
]

[env.production.vars]
ENVIRONMENT = "production"
LOG_LEVEL = "warn"
BACKEND_URL = "https://hr-dssweb-production.up.railway.app"
ALLOWED_ORIGINS = "https://hr.minu.best"

# Rate Limiting (Paid Plan 필요)
# [[env.production.unsafe.bindings]]
# name = "RATE_LIMITER"
# type = "ratelimit"
# namespace_id = "hr-dss-api"
# simple = { limit = 100, period = 60 }

# KV Namespace (캐싱용)
# [[kv_namespaces]]
# binding = "CACHE"
# id = ""
# preview_id = ""

# R2 Bucket (파일 저장용)
# [[r2_buckets]]
# binding = "ASSETS"
# bucket_name = "hr-dss-assets"

# Durable Objects (세션 관리용, 선택)
# [[durable_objects.bindings]]
# name = "SESSIONS"
# class_name = "SessionManager"

# 빌드 설정 없음 - wrangler가 자동으로 TypeScript 처리
